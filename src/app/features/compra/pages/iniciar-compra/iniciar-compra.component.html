<!-- src/app/features/compra/pages/iniciar-compra/iniciar-compra.component.html -->
<div class="iniciar-compra-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>
        <mat-icon color="primary">shopping_cart</mat-icon>
        Iniciar Compra: {{ listaDetalhes?.nome }}
      </mat-card-title>
      <mat-card-subtitle>
        Guie-se pela sua lista enquanto faz suas compras.
      </mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <div *ngIf="!listaDetalhes">
        <app-loading-spinner></app-loading-spinner>
        <p>Carregando lista...</p>
      </div>

      <form [formGroup]="shoppingForm" *ngIf="listaDetalhes">
        <div formArrayName="items" class="items-list">
          <ng-container *ngFor="let itemFormGroup of itemsFormArray.controls; let i = index; trackBy: trackByItemId">
            <app-compra-item
              [itemForm]="getItemFormGroup(i)"
              [itemOriginal]="listaDetalhes!.itens[i]"
            ></app-compra-item>
          </ng-container>
        </div>

        <div class="total-section">
          <h3>Total da Compra: {{ totalCompra | currency:'BRL':'symbol':'1.2-2' }}</h3>
        </div>
      </form>
    </mat-card-content>
    <mat-card-actions align="end">
      <button mat-raised-button color="warn" routerLink="/home">Cancelar</button>
      <button mat-raised-button color="primary" (click)="concluirCompra()" [disabled]="shoppingForm.invalid">
        Concluir Compra
      </button>
    </mat-card-actions>
  </mat-card>
</div>
