<app-infinite-scroll
  class="grid-container"
  [isLoading]="loading"
  [isLastPage]="isLastPage"
  (scrolledToEnd)="loadNextPage()"
>
  <!-- Loading inicial -->
  <div *ngIf="loading && listas.length === 0" class="loading-container">
    <app-loading-spinner size="lg"></app-loading-spinner>
  </div>

  <!-- Mensagem de erro -->
  <app-alert-message
    *ngIf="deveExibirMensagem"
    (closed)="onAlertClosed()"
    [message]="mensagemErro"
    type="error"
    [autoClose]="true"
  >
  </app-alert-message>

  <!-- Conteúdo -->
  <div *ngIf="listas.length > 0; else noLists">
    <mat-accordion>
      <mat-expansion-panel *ngFor="let lista of listas">
        <mat-expansion-panel-header>
          <mat-panel-title>
            <strong>{{ lista.nome }}</strong>
            <span>{{ lista.statusLista }} </span>
          </mat-panel-title>

          <mat-panel-description>
            <span>{{ lista.totalItens }} itens</span>
            <span class="total-value">
              {{ lista.valorTotal | currency: "BRL" : "symbol" : "1.2-2" }}
            </span>
          </mat-panel-description>

          <button
            mat-icon-button
            color="primary"
            [routerLink]="['/compra/iniciar', lista.id]"
            (click)="$event.stopPropagation()"
          >
            <mat-icon>shopping_cart</mat-icon>
          </button>
        </mat-expansion-panel-header>

        <ng-template matExpansionPanelContent>
          <app-lista-itens-view [lista]="lista"></app-lista-itens-view>
        </ng-template>
      </mat-expansion-panel>
    </mat-accordion>
  </div>

  <!-- Estado vazio -->
  <ng-template #noLists>
    <div *ngIf="!loading" class="no-lists-message">
      <p><i>Você ainda não tem nenhuma lista de compras.</i></p>
    </div>
  </ng-template>

  <!-- Loading de scroll -->
  <div *ngIf="loading && listas.length > 0" class="loading-more">
    <app-loading-spinner size="sm"></app-loading-spinner>
  </div>
</app-infinite-scroll>
