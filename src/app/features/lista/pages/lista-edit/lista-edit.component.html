<div class="lista-edit-container">
  <app-loading-spinner *ngIf="loadingInitial" size="md"></app-loading-spinner>

  <app-alert-message
    (closed)="onAlertClosed()"
    *ngIf="!loadingInitial && error"
    [message]="error"
    type="error"
    [autoClose]="true"
  >
  </app-alert-message>

  <mat-card *ngIf="!loadingInitial && !error && lista" class="lista-card">
    <mat-card-content>
      <form [formGroup]="listaForm" class="list-form">
        <!-- Nome da lista -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Nome da Lista</mat-label>
          <input
            matInput
            formControlName="nome"
            placeholder="Ex: Compras do mês"
          />
          <mat-error *ngIf="listaForm.get('nome')?.hasError('required')">
            O nome da lista é obrigatório.
          </mat-error>
        </mat-form-field>

        <span class="total-value-display">
          Total: {{ totalListaValor | currency: "BRL" }}
        </span>
      </form>

      <!-- Lista de itens -->
      <div
        *ngIf="itensLista.length > 0; else noItems"
        class="item-list-section"
      >
        <h3>Itens da Lista ({{ itensLista.length }} itens)</h3>
        <app-item-list-display
          [items]="itensLista"
          [isEditMode]="true"
          (quantityIncrement)="incrementarQuantidade($event)"
          (quantityDecrement)="decrementarQuantidade($event)"
          (itemRemove)="removerItem($event)"
        ></app-item-list-display>
      </div>

      <ng-template #noItems>
        <div class="empty-items-state">
          <mat-icon>add_shopping_cart</mat-icon>
          <p>Esta lista não possui itens. Adicione alguns!</p>
        </div>
      </ng-template>

      <div *ngIf="error" class="error-message">
        <mat-icon>error</mat-icon>
        {{ error }}
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Ações (com botão de excluir) -->
  <div class="actions" *ngIf="!loadingInitial && !error && lista">
    <div class="actions-content">
      <button
        mat-stroked-button
        color="warn"
        class="btn-delete"
        (click)="deleteList()"
        type="button"
      >
        <mat-icon>delete</mat-icon>
        <span class="btn-text">Excluir Lista</span>
      </button>

      <div class="spacer"></div>

      <button mat-button class="btn-cancel" type="button" (click)="goBack()">
        <mat-icon>block</mat-icon>
        <span class="btn-text">Cancelar</span>
      </button>

      <button
        mat-raised-button
        color="primary"
        class="btn-save"
        (click)="saveList()"
        type="button"
      >
        <mat-icon>check</mat-icon>
        <span class="btn-text">Salvar Alterações</span>
      </button>
    </div>
  </div>

  <button
    mat-fab
    color="accent"
    class="fab-add-item"
    (click)="openAddItemsModal()"
    [disabled]="loadingInitial"
  >
    <mat-icon>add</mat-icon>
  </button>
</div>
