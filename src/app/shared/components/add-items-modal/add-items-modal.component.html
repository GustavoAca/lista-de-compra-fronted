<h2 mat-dialog-title>Adicionar Itens à Lista</h2>

<mat-dialog-content>
  <!-- Busca por nome do item -->
  <div class="search-container">
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Buscar item</mat-label>
      <input
        matInput
        type="text"
        placeholder="Digite o nome do item"
        [formControl]="itemSearchControl"
      />
      <button
        *ngIf="itemSearchControl.value"
        matSuffix
        mat-icon-button
        aria-label="Limpar"
        (click)="itemSearchControl.setValue('')"
      >
        <mat-icon>close</mat-icon>
      </button>
    </mat-form-field>
  </div>

  <div class="modal-content-wrapper">
    <!-- Loading -->
    <app-loading-spinner *ngIf="loadingSellers || loadingItemOffers" size="md">
    </app-loading-spinner>

    <!-- Erro -->
    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
    </div>

    <!-- Seleção de vendedor (somente modo NÃO direto) -->
    <div *ngIf="!isDirectSellerMode" class="seller-selection-container">
      <mat-form-field appearance="outline" class="seller-select-full-width">
        <mat-label>Selecione um vendedor</mat-label>
        <mat-select [formControl]="selectedSellerControl">
          <mat-option *ngFor="let seller of sellers" [value]="seller">
            {{ seller.nome }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <!-- Nenhum item disponível -->
    <div
      *ngIf="!loadingItemOffers && resolveSellerId() && itemOffers.length === 0"
      class="no-items-message"
    >
      <p><i>Nenhum item disponível para este vendedor.</i></p>
    </div>

    <!-- Lista de itens -->
    <app-infinite-scroll
      *ngIf="resolveSellerId() && itemOffers.length > 0"
      [isLoading]="loadingItemOffers"
      [isLastPage]="isLastItemOfferPage"
      (scrolledToEnd)="loadItemOffers()"
    >
      <ul class="item-list">
        <li *ngFor="let item of itemOffers">
          <div class="item-display-row">
            <mat-checkbox
              [checked]="getQuantity(item) > 0"
              (change)="toggleItemSelection(item)"
              class="item-checkbox-name"
            >
              <span class="item-name">
                {{ item.item.nome }}
              </span>
            </mat-checkbox>

            <span class="flex-spacer"></span>

            <span class="item-details-right">
              <span class="item-price">
                {{ item.preco | currency: "BRL" }}
              </span>

              <span
                class="item-promotion"
                [class.on-promotion]="item.hasPromocaoAtiva"
              >
                Promoção:
                {{ item.hasPromocaoAtiva ? "Sim" : "Não" }}
              </span>

              <span class="quantity-controls">
                <button
                  mat-icon-button
                  (click)="decrementQuantity(item)"
                  [disabled]="getQuantity(item) === 0"
                >
                  <mat-icon>remove</mat-icon>
                </button>

                <span class="quantity-value">
                  {{ getQuantity(item) }}
                </span>

                <button mat-icon-button (click)="incrementQuantity(item)">
                  <mat-icon>add</mat-icon>
                </button>
              </span>
            </span>
          </div>
        </li>
      </ul>
    </app-infinite-scroll>
  </div>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="onCancel()">Cancelar</button>

  <button
    mat-flat-button
    color="primary"
    [disabled]="selectedItems.size === 0"
    (click)="onConfirm()"
  >
    Adicionar
  </button>
</mat-dialog-actions>
